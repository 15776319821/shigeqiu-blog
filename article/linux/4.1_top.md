# top

<!-- TOC -->

- [top](#top)
    - [语法](#语法)
    - [进程概况](#进程概况)
    - [资源概况](#资源概况)
    - [视图中交互命令](#视图中交互命令)
    - [常用场景](#常用场景)

<!-- /TOC -->


## 语法

``` sh
[root@namenode ~]# top -h
  procps-ng version 3.3.10
Usage:
  top -hv | -bcHiOSs -d secs -n max -u|U user -p pid(s) -o field -w [cols]
```

- `-h | -v` : 显示帮助或者版本信息】
- `-b` : 以批处理模式显示程序信息
- `-c` : 命令行列显示程序名以及参数
- `-H` ： 设置线程模式
- `-i` : 只显示活跃进程，不显示任何闲置 (idle) 或无用 (zombie) 的进程
- `-S` : 以累积模式显示程序信息
- `-s` : 安全模式，将交谈式指令取消, 避免潜在的危机
- `-d` : 启动时设置刷新时间间隔
- `-n` : 设置信息更新次数
- `-u` : 显示指定用户的进程
- `-p` : 显示指定PID的进程


## 进程概况

序号 | 列名  |  含义
|:---:|:---:|:---|
| a  |  PID        |   进程id
| b  |  PPID       |   父进程id
| c  |  RUSER      |   Real user name
| d  |  UID        |   进程所有者的用户id
| e  |  USER       |   进程所有者的用户名
| f  |  GROUP      |   进程所有者的组名
| g  |  TTY        |   启动进程的终端名。不是从终端启动的进程则显示为 ?
| h  |  PR         |   优先级
| i  |  NI         |   nice值。负值表示高优先级，正值表示低优先级
| j  |  P          |   最后使用的CPU，仅在多CPU环境下有意义
| k  |  %CPU       |   上次更新到现在的CPU时间占用百分比
| l  |  TIME       |   进程使用的CPU时间总计，单位秒
| m  |  TIME+      |   进程使用的CPU时间总计，单位1/100秒
| n  |  %MEM       |   进程使用的物理内存百分比
| o  |  VIRT       |   进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES
| p  |  SWAP       |   进程使用的虚拟内存中，被换出的大小，单位kb。
| q  |  RES        |   进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA
| r  |  CODE       |   可执行代码占用的物理内存大小，单位kb
| s  |  DATA       |   可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb
| t  |  SHR        |   共享内存大小，单位kb
| u  |  nFLT       |   页面错误次数
| v  |  nDRT       |   最后一次写入到现在，被修改过的页面数。
| w  |  S          |   进程状态(D=不可中断的睡眠状态,R=运行,S=睡眠,T=跟踪/停止,Z=僵尸进程)
| x  |  COMMAND    |   命令名/命令行
| y  |  WCHAN      |   若该进程在睡眠，则显示睡眠中的系统函数名
| z  |  Flags      |   任务标志，参考 sched.h

## 资源概况

1. 操作系统时间、登录用户、负载情况 - top

```
top - 09:56:25 up 49 days, 15:19,  1 user,  load average: 0.01, 0.05, 0.05
```

- 9:56:25：当前系统时间。
- up 49 days, 15:19：操作系统从开机后运行的时间，运行天时分。
- users：当前系统三个用户登录在线。
- load average：1，5，15min的系统平均负载。

2. 运行任务概况 - tasks

```
Tasks: 147 total,   1 running, 146 sleeping,   0 stopped,   0 zombie
```

- total：系统当前运行进程数。
- running：当前运行的进程数。
- sleeping：睡眠中的进程数。

3. CPU概览： %Cpu(s) 表示CPU使用百分比，按照时间占用计算，单位s

```
%Cpu(s):  0.0 us,  0.8 sy,  0.0 ni, 99.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
```

- us：用户空间占用cpu时间百分比，如果是多核，这个数值表示占用的平均百分比，可以按1进行多核统计和平均统计切换。
- sy：内核空间占用cpu时间百分比，后续同上。
- ni：用户空间改变过优先级的进程占用cpu时间百分比。
- id：空闲时间占用cpu的百分比。
- wa：等待输入输出占用cpu时间百分比。
- hi：硬中断占用cpu时间百分比。
- si：软中断占用cpu时间百分比。

时间占用百分比=该种类型操作消耗cpu时间/top刷新间隔时间。top每3s刷新一次，用户空间进程在这3秒内试用了cpu时间1.5s，那么us为50%=1.5s/3s。

4. 内存概览（KB）

```
KiB Mem : 32781220 total,  9375268 free, 10749464 used, 12656488 buff/cache
```

- total：内存总量。
- free：内存剩余总量。
- used：内存使用数量。
- buff/cached：用于缓冲的内存数量。

5. 缓存区概况（KB）

```
KiB Swap:        0 total,        0 free,        0 used. 21365776 avail Mem
```

- total：交换区总量。
- free：空闲交换区数量。
- used：使用交换区数量。


## 视图中交互命令

全局

- Enter/Space：刷新视图。
- h：帮助信息，查询各个交互命令的含义。
- 0(数字零)：是否展示进程区域中的0值，比如%CPU是0的将全部隐藏。
- A：在全屏模式和多窗口选择模式中切换。
- d：设置刷新时间间隔。
- E：切换内存和交换区单位。
- H：开启/关闭线程模式，以线程的方式展示。
- k：杀掉指定进程或线程。
- Z：改变颜色配置。
- q：退出。

概要区域

- 1：显示CPU平均状态/分开显示各个逻辑CPU状态。
- m：切换显示内存统计的数据。

进程区域

- x：切换高亮行的排序位置。
- z：切换颜色。
- b：块状标记高亮行。
- c：切换显示命令/程序名和参数（在`Command`列中显示正在运行的进程的路径）。
- f：显示field管理。
- u：按照执行用户显示进程。
- i：显示所有进程或活跃的进程。
- n：设置显示的进程数。

## 常用场景

```
top -H -p pid # 显示某个进程所有活跃的线程消耗情况。
```